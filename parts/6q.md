# 6. Алгебраический (индуктивный) тип данных. Сравнение с системой типов языка Си. Сопоставление с образцом.

## Алгебраический (индуктивный) тип данных (АТД).

```{glossary}
Алгебраические (индуктивные) типы данных
    позволяет определять типы данных через комбинацию других типов.
```

```{epigraph}
Тип данных, состоящий из нескольких различимых разновидностей (возможно, составных) термов (значений).

-- Пенской А.В.
```
```haskell
data Shape = Circle Float | Rectangle Float Float  -- Тип-сумма с конструкторами
```

Алгебраический (индуктивный) тип данных (АТД) бывает:
- **Сумма типов**: типы, которые представляют собой выбор между несколькими вариантами (например, `Circle` или `Rectangle`)
- **Произведения типов**: группировка нескольких значений в один тип (например, Rectangle содержит два поля).

```haskell
data JSObject = JSNull
              | JSBool Bool
              | JSRational Bool Rational
              | JSString String
              | JSArray [ JSObject ]
              | JSObject ( String, JSObject )
```

- Алгебраические типы могут быть **рекурсивными** (например, `JSObject` в нашем случае).

## Сравнение с системой типов в Си

- **Произведения типов**: Реализуются через struct

```c
struct Rectangle { float width, height; };  // Аналог типа-произведения
```

- **Сумма типов**: Эмулируются через union + enum, но **без безопасности**:

```C
typedef enum { CIRCLE, RECTANGLE } ShapeType;
typedef struct {
    ShapeType type;
    union {
        float radius;
        struct { float w, h; } rect;
    } data;
} Shape;
```

- Нет проверки соответствия тега `(type)` и активного поля в `union`.
- Компилятор не гарантирует обработку всех вариантов в `switch`. (тоже справедливо при реализации через наследования в ООП).

## Сопоставление с образцом

- **В АТД-языках** (Haskell, ML, Rust):

    ```haskell
    area :: Shape -> Float
    area (Circle r) = pi * r^2
    area (Rectangle w h) = w * h
    ```

    - Проверка **полноты**: Компилятор требует обработки всех вариантов.
    - Декомпозиция вложенных структур за один шаг.

- **В Си**:

    ```haskell
    float area(Shape s) {
        switch (s.type) {
            case CIRCLE: return 3.14 * s.data.radius * s.data.radius;
            case RECTANGLE: return s.data.rect.w * s.data.rect.h;
            default: return 0;  // Обязательная "заглушка"
        }
    }
    ```
    - Нет проверки на пропущенные варианты.
    - Ручное управление тегами и полями.